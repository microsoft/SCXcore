%Variables
SUDO_DIR: '/opt/sfw/bin'
PFMINOR: '10'
PFMAJOR: '5'

%Files
/var/svc/manifest/application/management/scx-cimd.xml; installer/conf/svc-manifest/scx-cimd.xml; 444; root; sys
/opt/microsoft/scx/bin/tools/scx-cimd; installer/conf/svc-method/scx-cimd; 555; root; bin

%Directories
/var/svc/manifest/application/management;  700; root; root; sysdir

%Dependencies
P SUNWcsr	Core Solaris, (Root)
P SUNWcslr	Core Solaris Libraries (Root)
P SUNWcsl	Core Solaris, (Shared Libs)
P SUNWlibmsr	Math & Microtasking Libraries (Root)
P SUNWlibC	Sun Workshop Compilers Bundled libC
P SUNWopenssl-libraries	OpenSSL Libraries (Usr)

%OmiService_funcs
StopOmiService() {
    svcadm disable -s svc:/application/management/scx-cimd
}

RemoveOmiService() {
    svccfg delete svc:/application/management/scx-cimd:default
}

%Postinstall_1050
# ConfigureOmiService
svccfg import /var/svc/manifest/application/management/scx-cimd.xml

%Postinstall_1100
# StartOmiService
StartOmiService() {
    set +e
    COUNT=0
    while [ $COUNT -lt 15 ]; do
	echo "Waiting for service: svc:/application/management/scx-cimd ..."
	sleep 1
	/usr/bin/svcs -H svc:/application/management/scx-cimd 2> /dev/null | grep -i online > /dev/null 2>&1
	[ $? -eq 0 ] && break
	COUNT=`expr $COUNT + 1`
    done
}

StartOmiService

%Preuninstall_100
#include OmiService_funcs
StopOmiService

%Preuninstall_200
RemoveOmiService


