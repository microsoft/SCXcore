%Variables
PF:	'Linux'

%OmiService_funcs
StopOmiServer() {
#ifdef ULINUX
    if [ -x /usr/sbin/invoke-rc.d ]; then
	/usr/sbin/invoke-rc.d omiserverd stop
    elif [ -x /sbin/service ]; then
	service omiserverd stop
    else
	echo "Unrecognized Service Controller to start OMI Service"
	exit 1
    fi

#elseif PFDISTRO == SUSE 
#if PFMAJOR == 9
    /etc/init.d/omiserverd stop
#else
    service omiserverd stop
#endif
#else
    service omiserverd stop
#endif
}

StartOmiServer() {
#ifdef ULINUX
    if [ -x /usr/sbin/invoke-rc.d ]; then
	/usr/sbin/invoke-rc.d omiserverd start
    elif [ -x /sbin/service ]; then
	service omiserverd start
    else
	echo "Unrecognized Service Controller to start OMI Service"
	exit 1
    fi
    
#elseif PFDISTRO == SUSE 
#if PFMAJOR == 9
    /etc/init.d/omiserverd start
#else
    service omiserverd start
#endif
#else
    service omiserverd start
#endif
}

%Preinstall_10
#include OmiService_funcs
#include CheckIfOmiIsRunning
if [ $OMI_IS_RUNNING -eq 1 ]; then
    StopOmiServer
fi

%Postinstall_875
set -e


%Postinstall_1100
#include OmiService_funcs
StartOmiServer

%Preuninstall_800
#include DeleteSoftLinkToSudo
DeleteSoftLinkToSudo
