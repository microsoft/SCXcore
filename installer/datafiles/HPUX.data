%Variables
PF: 'HPUX'
HPUX_COPYRIGHT: 'Copyright (c) Microsoft Corporation.  All rights reserved.'

%Dependencies
omi,r>=1.0.8-1

%OmiService_funcs
StopOmiServer() {
    /sbin/init.d/omiserverd stop
}

StartOmiServer() {
    /sbin/init.d/omiserverd start
}

%Preinstall_10
#include OmiService_funcs
#include CheckIfOmiIsRunning
if [ $OMI_IS_RUNNING -eq 1 ]; then
    StopOmiServer
fi

%Preinstall_500
# RemoveDeletedFiles
rm -f ${{SCXHOME}}/lib/libpegCLIClientLib.*
rm -f ${{SCXHOME}}/lib/libpegcql.*
rm -Rf /var/opt/microsoft/scx/lib/repository/root#scx/classes

%Postinstall_950
set -e

%Postinstall_1100
#include OmiService_funcs
StartOmiServer

%Preuninstall_9
#include OmiService_funcs
#include CheckIfOmiIsRunning
if [ $OMI_IS_RUNNING -eq 1 ]; then
    StopOmiServer
fi

%Postuninstall_100
#include DeleteSoftLinkToSudo
DeleteSoftLinkToSudo

%Postuninstall_200
RemoveEmptyDirectoryRecursive() {
    find $1 -type d | sort -r |
    while read D
    do
        ls -l $D | grep -q 'total 0' && rmdir  $D 2>/dev/null
    done
}

RemoveEmptyDirectoryRecursive /opt/microsoft/scx
RemoveEmptyDirectoryRecursive /etc/opt/microsoft/scx
RemoveEmptyDirectoryRecursive /var/opt/microsoft/scx
rmdir /opt/microsoft 2>&1 > /dev/null

%Postuninstall_1100
#include OmiService_funcs
StartOmiServer
