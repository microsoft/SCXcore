%Variables
PF: 'HPUX'
pam_dir_passwd: 'auth required libpam_hpsec.so.1\nauth required libpam_unix.so.1\naccount required libpam_hpsec.so.1\naccount required libpam_unix.so.1'
pam_file_passwd: 'omi auth required libpam_hpsec.so.1\nomi auth required libpam_unix.so.1\nomi account required libpam_hpsec.so.1\nomi account required libpam_unix.so.1'
HPUX_COPYRIGHT: 'Copyright (c) Microsoft Corporation.  All rights reserved.'

%Files
/sbin/init.d/scx-cimd; installer/conf/init.d/scx-cimd.hpux; 744; root; ${{ROOT_GROUP_NAME}}

%Directories
/var/log;     755; root; sys; sysdir
/sbin;        755; root; bin; sysdir
/sbin/init.d; 755; root; bin; sysdir
/sbin/rc2.d;  755; root; bin; sysdir
/sbin/rc1.d;  755; root; bin; sysdir

%Links
/sbin/rc2.d/S999scx-cimd; ../init.d/scx-cimd; 744; root; ${{ROOT_GROUP_NAME}}
/sbin/rc1.d/K100scx-cimd; ../init.d/scx-cimd; 744; root; ${{ROOT_GROUP_NAME}}


%Dependencies
openssl.OPENSSL-LIB,r>=A.00.09.07l.003,r<A.00.09.08 | openssl.OPENSSL-LIB,r>=A.00.09.08d.002

%OmiService_funcs
StopOmiService() {
    /sbin/init.d/scx-cimd stop
}

%Preinstall_10
#include OmiService_funcs

%Preinstall_200
if [ -f /etc/opt/microsoft/scx/conf/installinfo.txt ]; then

%Preinstall_300
StopOmiService

%Preinstall_400
# RemoveOmiService

%Preinstall_500
# RemoveDeletedFiles
rm -f ${{SCXHOME}}/lib/libpegCLIClientLib.*
rm -f ${{SCXHOME}}/lib/libpegcql.*
rm -Rf /var/opt/microsoft/scx/lib/repository/root#scx/classes

%Preinstall_600
fi  ## if [ -f /etc/opt/microsoft/scx/conf/installinfo.txt ]

%Postinstall_950
set -e

%Postinstall_1100
# StartOmiService
/sbin/init.d/scx-cimd start

%Preuninstall_100
#include OmiService_funcs
StopOmiService

%Postuninstall_100
#include DeleteSoftLinkToSudo
DeleteSoftLinkToSudo

%Postuninstall_200
RemoveEmptyDirectoryRecursive() {
    find $1 -type d | sort -r |
    while read D
    do
        ls -l $D | grep -q 'total 0' && rmdir  $D 2>/dev/null
    done
}

RemoveEmptyDirectoryRecursive /opt/microsoft/scx
RemoveEmptyDirectoryRecursive /etc/opt/microsoft/scx
RemoveEmptyDirectoryRecursive /var/opt/microsoft/scx
rmdir /opt/microsoft 2>&1 > /dev/null
